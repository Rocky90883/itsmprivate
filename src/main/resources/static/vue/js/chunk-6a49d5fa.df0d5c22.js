(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6a49d5fa"],{"0f2d":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"assetRegister h100"},[a("div",{staticClass:"page-main-box"},["list"==t.pageType?a("KlTable",t._b({ref:"klTable"},"KlTable",t.tableConfig,!1)):t._e(),"list"!==t.pageType?a("editPage",{attrs:{rightBtnArr:t.rightBtnArr},on:{goBackPage:t.goBackPage}},["details"==t.pageType?a("detailsInfo",{key:"details",ref:"details",attrs:{formData:t.formData}}):t._e()],1):t._e(),a("dialogPublic",{attrs:{title:"部门",show:t.showMember,appendTobody:"",width:"800px",height:"400px"},on:{"update:show":function(e){t.showMember=e},doSubmit:t.chooseUser,doClose:function(){return t.showMember=!1}}},[t.showMember?a("orgMemberSelect",{ref:"orgMemberSelect",attrs:{seleteSetting:t.orgMemberSelect,otherInfo:t.otherInfo}}):t._e()],1),a("dialogPublic",{attrs:{title:"资产分配-编辑 / 数量："+t.formData.portionQty,show:t.editDialog,appendTobody:"",width:"800px",height:"400px"},on:{"update:show":function(e){t.editDialog=e},doSubmit:t.editSubmit,doClose:function(){return t.editDialog=!1}}},[t.editDialog?a("editDialog",{ref:"distributionFrom",attrs:{formData:t.formData}}):t._e()],1)],1)])},i=[],n=(a("b0c0"),a("d3b7"),a("ac1f"),a("1276"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"editDialog"},[a("editForm",{ref:"editForm",attrs:{formConfig:t.formConfig,formData:t.editFormData}})],1)}),s=[],r={props:{formData:{type:Object,default:{}}},name:"editDialog",data:function(){return{editFormData:{},formConfig:{itemArr:[{type:"select",label:"资产分类",prop:"assetTypeName",id:"assetTypeId",required:!0,disabled:!0,seleteOption:this.$store.getters.assetTypeList,span:24},{label:"分配型号",prop:"goodsModel",required:!0,disabled:!0,type:"text",span:24},{label:"分配日期",prop:"billDate",type:"date",required:!0,span:24},{label:"分配部门",prop:"depatName",idsStr:"depatCode",type:"dept",disabled:!0,trigger:"change",required:!0,span:24},{label:"分配数量",prop:"portionQty",type:"el-number",required:!0,min:0,max:this.maxNum,precision:0,step:1,span:24}]}}},created:function(){this.init()},methods:{init:function(){this.editFormData=Object.assign({},this.formData)},getFormData:function(){var t=this;return new Promise((function(e,a){t.$refs.editForm.getFormData().then((function(t){t=Object.assign({},t),e(t)})).catch((function(t){a(t)}))}))}}},l=r,d=a("2877"),c=Object(d["a"])(l,n,s,!1,null,null,null),u=c.exports,f=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"h100"},[a("KlTable",t._b({ref:"klTable"},"KlTable",t.tableConfig,!1)),a("dialogPublic",{attrs:{title:t.title,show:t.addDialog,appendTobody:"",width:"800px",height:"400px"},on:{"update:show":function(e){t.addDialog=e},doSubmit:t.editSubmit,doClose:function(){return t.addDialog=!1}}},[t.addDialog?a("addDialog",{ref:"distributionFrom",attrs:{formData:t.addFormData,selectUserOption:t.selectUserOption}}):t._e()],1)],1)},p=[],h=(a("d81d"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"editDialog"},[a("editForm",{ref:"addeditForm",attrs:{formConfig:t.formConfig,formData:t.editFormData}})],1)}),m=[],b={props:{formData:{type:Object,default:{}},selectUserOption:{type:Array,default:[]}},name:"editDialog",data:function(){var t=this;return{editFormData:{},formConfig:{itemArr:[{type:"text",label:"资产分类",prop:"assetTypeName",id:"assetTypeId",span:24,required:!0,disabled:!0},{label:"资产型号",prop:"goodsModel",required:!0,disabled:!0,type:"text",span:24},{label:"分配日期",prop:"billDate",type:"date",required:!0,span:24},{label:"归属人",prop:"staffunName",type:"autocomplete",trigger:"change",placeholder:"可输入关键词查找归属人",required:!0,seleteOption:this.selectUserOption,selectMethods:function(e){t.$refs.addeditForm.setFormItem("empId",e.id)},span:24},{label:"备注",prop:"remark",type:"textarea",span:24,rows:4}]}}},created:function(){this.init()},methods:{init:function(){this.editFormData=Object.assign({},this.formData)},getFormData:function(){var t=this;return new Promise((function(e,a){t.$refs.addeditForm.getFormData().then((function(t){t=Object.assign({},t),e(t)})).catch((function(t){a(t)}))}))}}},g=b,D=Object(d["a"])(g,h,m,!1,null,null,null),y=D.exports,w=a("fd03");function T(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(w["a"])({url:"/asset/assetsPortionAction/queryList",method:"post",data:t})}function O(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(w["a"])({url:"/asset/assetsPortionAction/updatePortion",method:"post",data:t})}function j(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(w["a"])({url:"/asset/assetsPortionDetAction/queryList",method:"post",data:t})}function v(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Object(w["a"])({url:"/asset/assetsPortionAction/deletePortion",method:"post",data:{id:t}})}function C(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Object(w["a"])({url:"/asset/assetsPortionDetAction/deletePortionDet",method:"post",data:{id:t}})}function S(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(w["a"])({url:"/asset/assetsPortionDetAction/addPortionDet",method:"post",data:t})}function $(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(w["a"])({url:"/asset/assetsPortionDetAction/updatePortionDet",method:"post",data:t})}var F=a("2934"),q={name:"assetAllocation",props:{formData:{type:Object,default:function(){return{}}}},components:{addDialog:y},data:function(){var t=this;return{addDialog:!1,title:"",addFormData:{},tableConfig:{showFixedHeight:!0,searchObj:{searchMethod:function(e,a){t.tableConfig.tableDataObj&&t.getTableData()},searchArr:[{type:"el-input",label:"领用人",model:"staffunName",id:"empId",placeholder:"领用人",scopeType:"formate",method:function(e){t.chooseStaff("user")}},{type:"date",label:"分配日期",model:"billDate"}]},queryObj:{method:function(){t.getTableData()},queryData:{page:1,pageSize:15}},tableDataObj:{tableArr:[],total:null},operateArr:[{name:"新建",isHide:this.remainingNum,icon:"el-icon-plus",method:function(e){t.toAdd()}}],tableObj:{selectionShow:!1,indexShow:!0,tableMethods:{selection:function(e){t.selectionData=e}},showItems:[{name:"资产分类",prop:"assetTypeName",id:"assetsNumber"},{name:"型号",prop:"goodsModel"},{name:"领用人",prop:"staffunName"},{name:"资产编号",prop:"assetsNumber",width:150},{name:"分配日期",prop:"billDate",width:140},{name:"资产状态",prop:"assetsStatus",scopeType:"formate",method:function(e){var a=e.assetsStatus;return t.$store.getters["fineDirtDataName"]("assets_status",a)||a}},{name:"操作",prop:"operate",width:150,scopeType:"button",fixed:"right",buttonArr:[{name:"编辑",method:function(e){t.editInfo(e)},isShow:function(t,e){return!0},icon:"false"},{name:"删除",method:function(e){t.deleteInfo(e)},isShow:function(t,e){return!0},icon:"false"}]}]},paginationObj:{pageSizes:[15,30,50,100]},paginationIsshow:!0,showklTable:!1},pageType:"list",selectUserOption:[],remainingNum:0}},computed:{},watch:{},mounted:function(){this.addFormData={assetTypeName:this.formData.assetTypeName,assetTypeId:this.formData.assetTypeId,goodsModel:this.formData.goodsModel,fRef:this.formData.id,billDate:this.$utils.getNowDay()},this.remainingNum=this.formData.portionQty-this.formData.overQty,this.getUserList(),this.getTableData()},methods:{getUserList:function(){var t=this,e={orgNodeCode:this.formData.depatCode};Object(F["n"])(e).then((function(e){var a=e.data||[];a.map((function(t){return t.value=t.name,t.id=t.code})),t.selectUserOption=a}))},getTableData:function(){var t=this,e=Object.assign({},this.tableConfig.queryObj.queryData,{fRef:this.formData.id});e.pageCount=e.pageSize,this.$delete(e,"pageSize"),this.$delete(e,"staffunName"),j(e).then((function(e){t.$set(t.tableConfig.tableDataObj,"tableArr",e.data.list||[]),t.$set(t.tableConfig.tableDataObj,"total",e.data.total||0)})).catch((function(e){t.$set(t.tableConfig.tableDataObj,"tableArr",[]),t.$set(t.tableConfig.tableDataObj,"total",0)}))},deleteInfo:function(t){var e=this;this.$confirm("是否确认删除","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){C(t.id).then((function(t){e.$message.success("删除操作成功"),e.getTableData()}))})).catch((function(t){}))},toAdd:function(){this.title="新建",this.addDialog=!0},editInfo:function(t){this.title="编辑",this.addDialog=!0,this.addFormData=t},editSubmit:function(){var t=this;this.$refs.distributionFrom.getFormData().then((function(e){t.addDistribution(e).then((function(e){t.$message.success("操作成功！"),t.addDialog=!1,t.getTableData()}))})).catch((function(t){console.log(t)}))},addDistribution:function(t){return this.$delete(t,"assetTypeId"),t.id?new Promise((function(e,a){$(t).then((function(t){e(t)})).catch((function(t){console.log(t),a(t)}))})):new Promise((function(e,a){S(t).then((function(t){e(t)})).catch((function(t){console.log(t),a(t)}))}))}}},I=q,N=(a("31e0"),Object(d["a"])(I,f,p,!1,null,null,null)),A=N.exports,M={name:"assetAllocation",components:{editDialog:u,detailsInfo:A},data:function(){var t=this;return{label:"",otherInfo:"",showMember:!1,details:!1,editDialog:!1,currentItem:{},orgMemberSelect:{},tableConfig:{showFixedHeight:!0,searchObj:{searchMethod:function(e,a){t.tableConfig.tableDataObj&&t.getTableData()},searchArr:[{type:"el-input",label:"型号",model:"goodsModel",placeholder:"模糊查询"},{type:"el-select",label:"资产分类",model:"assetTypeId",option:this.$store.getters.assetTypeList},{type:"el-input",label:"部门",model:"depatName",method:function(e){t.chooseStaff("dept")},placeholder:"部门"}]},queryObj:{method:function(){t.getTableData()},queryData:{page:1,pageSize:15}},tableDataObj:{tableArr:[],total:null},operateArr:[],tableObj:{selectionShow:!1,indexShow:!0,tableMethods:{selection:function(e){t.selectionData=e}},showItems:[{name:"单据编号",prop:"portionBillNo",width:100},{name:"资产分类",prop:"assetTypeName"},{name:"品牌",prop:"brand",id:"brand_type",width:50},{name:"型号",prop:"goodsModel"},{name:"部门",prop:"depatName",width:120},{name:"数量",prop:"portionQty",width:60},{name:"已分配数量",prop:"overQty",width:60},{name:"分配日期",prop:"billDate",width:100},{name:"登记合同号",prop:"registBillNo",width:120},{name:"操作",prop:"operate",width:150,scopeType:"button",fixed:"right",buttonArr:[{name:"详情",method:function(e){t.detailsInfo(e)},isShow:function(t,e){return!0},icon:"false"},{name:"编辑",method:function(e){t.editInfo(e)},isShow:function(t,e){return!0},icon:"false"},{name:"删除",method:function(e){t.deleteInfo(e)},isShow:function(t,e){return"0"==t.billDate},icon:"false"}]}]},paginationObj:{pageSizes:[15,30,50,100]},paginationIsshow:!0,showklTable:!1},pageType:"list",formData:{}}},computed:{rightBtnArr:function(){}},watch:{pageType:function(t){"list"===t&&this.getTableData()},"tableConfig.queryObj.queryData.depatName":function(t){""==t&&(this.tableConfig.queryObj.queryData.depatCode="")}},mounted:function(){this.getTableData()},methods:{getTableData:function(){var t=this,e=Object.assign({},this.tableConfig.queryObj.queryData);for(var a in e.pageCount=e.pageSize,this.$delete(e,"pageSize"),this.$delete(e,"depatName"),e)""==e[a]&&delete e[a];T(e).then((function(e){t.$set(t.tableConfig.tableDataObj,"tableArr",e.data.list||[]),t.$set(t.tableConfig.tableDataObj,"total",e.data.total||0)})).catch((function(e){t.$set(t.tableConfig.tableDataObj,"tableArr",[]),t.$set(t.tableConfig.tableDataObj,"total",0)}))},chooseStaff:function(t){var e=t.split("-")[0],a=t.split("-")[1];this.selectType=e,"dept"==e?this.orgMemberSelect={seleteType:a||"org",radio:"dept"==e,props:{label:"organizationName",children:"children"},column:[{label:"组织",prop:"name"}],chosedData:[]}:"user"==e&&(this.orgMemberSelect={seleteType:a||"orgmember",radio:"user"==e,props:{label:"organizationName",children:"children"},column:[{label:"姓名",prop:"name",width:60}],chosedData:[]}),this.showMember=!0},chooseUser:function(){var t=this.$refs.orgMemberSelect.getSeleteData(),e=t[0];"dept"==this.selectType?e&&(this.$set(this.tableConfig.queryObj.queryData,"depatName",e.name),this.$set(this.tableConfig.queryObj.queryData,"depatCode",e.id)):"user"==this.selectType&&e&&(this.$set(this.tableConfig.queryObj.queryData,"staffunName",e.name),this.$set(this.tableConfig.queryObj.queryData,"empId",e.id)),this.showMember=!1},editInfo:function(t){this.editDialog=!0,this.formData=Object.assign({},t)},detailsInfo:function(t){this.pageType="details",this.formData=Object.assign({},t)},deleteInfo:function(t){var e=this;this.$confirm("是否确认删除","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){v(t.id).then((function(t){e.$message.success("删除操作成功"),e.getTableData()}))})).catch((function(t){}))},editSubmit:function(){var t=this;this.$refs.distributionFrom.getFormData().then((function(e){t.editDistribution(e).then((function(e){t.$message.success("操作成功！"),t.editDialog=!1,t.getTableData()}))})).catch((function(t){console.log(t)}))},editDistribution:function(t){return new Promise((function(e,a){O(t).then((function(t){e(t)})).catch((function(t){console.log(t),a(t)}))}))},doSubmit:function(){var t=this;this.$refs.editForm.getFormData().then((function(e){t.actionMethons(e).then((function(a){t.$message.success("操作成功！"),e.id||(t.formData={id:a.data}),t.pageType="edit",t.$refs.editForm.getDetails(t.formData.id)}))})).catch((function(t){console.log(t)}))},actionMethons:function(t){},goBackPage:function(t){this.pageType="list"}}},x=M,P=(a("b134"),Object(d["a"])(x,o,i,!1,null,null,null));e["default"]=P.exports},"31e0":function(t,e,a){"use strict";var o=a("cc02"),i=a.n(o);i.a},b134:function(t,e,a){"use strict";var o=a("b5d1"),i=a.n(o);i.a},b5d1:function(t,e,a){},cc02:function(t,e,a){}}]);
//# sourceMappingURL=chunk-6a49d5fa.df0d5c22.js.map