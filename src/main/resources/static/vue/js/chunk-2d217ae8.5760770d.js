(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d217ae8"],{c885:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"changeManagement h100"},[a("div",{staticClass:"page-main-box"},["list"==t.pageType?a("KlTable",t._b({ref:"klTable"},"KlTable",t.tableConfig,!1)):t._e(),"list"!==t.pageType?a("editPage",{attrs:{rightBtnArr:t.rightBtnArr},on:{goBackPage:t.goBackPage}},[a("addInfo",{ref:"editForm",attrs:{pageType:t.pageType,formData:t.formData},on:{"update:pageType":function(e){t.pageType=e},"update:page-type":function(e){t.pageType=e}}})],1):t._e()],1),a("dialogPublic",{attrs:{title:"变更管理-分配",show:t.distributionDialog,appendTobody:"",width:"800px",height:"400px"},on:{"update:show":function(e){t.distributionDialog=e},doSubmit:t.distributionSubmit,doClose:function(){return t.distributionDialog=!1}}},[a("distributionDialog",{ref:"distributionFrom",attrs:{distributionData:t.distributionData}})],1)],1)},o=[],n=(a("99af"),a("d3b7"),a("ade3")),r=a("3835"),s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"record__content"},[a("div",{staticClass:"record__baseinfo"},[a("dividerTitle",{attrs:{title:"基本信息"}}),a("editForm",{ref:"editForm",attrs:{formConfig:t.formConfig,formData:t.editFormData},scopedSlots:t._u([{key:"serviceOrderNo",fn:function(e){var i=e.editFormInfo;return[a("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请选择服务工单号",readonly:"",disabled:"details"==t.pageType&&!t.isWorkFlowEdit,size:"mini"},model:{value:i.serviceOrderNo,callback:function(e){t.$set(i,"serviceOrderNo",e)},expression:"editFormInfo.serviceOrderNo"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:function(e){return e.stopPropagation(),t.getServiceType(e)}},slot:"append"})],1)]}}])})],1),t.editFormData.status&&1==t.editFormData.status?a("div",{staticClass:"process_score"},[a("dividerTitle",{attrs:{title:"评分"}}),t.showScore?a("processScore",{attrs:{scoreSetting:t.scoreSetting,hideBtn:t.scoreHideBtn,showScore:t.showScore},on:{"update:showScore":function(e){t.showScore=e},"update:show-score":function(e){t.showScore=e}}}):t._e()],1):t._e(),a("div",{staticClass:"record__attach"},[a("dividerTitle",{attrs:{title:"附件"}}),a("attachTable",{ref:"attachFile",attrs:{attachSetting:t.attachSetting,hideBtn:t.hideBtn}})],1),"details"==t.pageType&&t.editFormData.status&&2!==t.editFormData.status?a("div",{staticClass:"record__workflow"},[a("dividerTitle",{attrs:{title:"工作流"}}),a("workFlow",{attrs:{currentFlowData:t.editFormData,beforeSubmit:t.beforeSubmit,otherParams:t.workFlowParams},on:{submitSuccess:t.workFlowSuccess}})],1):t._e(),t.showSelete?a("serviceNumberSelect",{attrs:{hadSeleteData:t.hadSeleteData,showSelete:t.showSelete,userID:t.employeeId},on:{changeSelete:t.changeServiceType,"update:showSelete":function(e){t.showSelete=e},"update:show-selete":function(e){t.showSelete=e}}}):t._e()],1)},c=[],d=(a("d81d"),a("b0c0"),a("96cf"),a("1da1")),l=a("5530"),u=a("fd03");function p(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(u["a"])({url:"/maintain/MtModifyAction/queryList.htm",method:"post",data:t})}function f(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Object(u["a"])({url:"/maintain/MtModifyAction/detail.htm",method:"post",params:{id:t}})}function m(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Object(u["a"])({url:"/maintain/MtModifyAction/delete.htm",method:"post",params:{id:t}})}function h(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(u["a"])({url:"/maintain/MtModifyAction/addMtModify.htm",method:"post",data:t})}function b(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(u["a"])({url:"/maintain/MtModifyAction/updateMtModify.htm",method:"post",data:t})}var g,y={props:{formData:{type:Object,default:new Object},pageType:{type:String,default:""},defaultSet:{type:Boolean,default:!1}},data:function(){var t=this;return{hadSeleteData:[],employeeId:null,showSelete:!1,editFormData:{suitableWorkArr:[]},trainingType:{},formConfig:{itemArr:[{label:"申请日期",prop:"billDate",type:"date",required:!0,span:8},{label:"申请人",prop:"staffunName",idsStr:"employeeId",type:"user",trigger:"change",required:!0,methods:function(e){var a=e[0],i=a.orgNodeName,o=a.orgNodeCode,n=a.mobile,r=a.id;t.employeeId=r,t.$refs.editForm.setFormItem("depatName",i),t.$refs.editForm.setFormItem("depatCode",o),t.$refs.editForm.setFormItem("phone",n)}},{type:"select",label:"影响范围",prop:"affectType",required:!0,seleteOption:this.$store.getters["dirtData"]("affect_type"),formatter:function(e){return t.$store.getters["fineDirtDataName"]("affect_type",e)}},{label:"服务工单号",prop:"serviceOrderNo",idsStr:"serviceId",type:"text"},{label:"服务类型",prop:"serviceType",type:"text",placeholder:"选择服务工单号后自动填入",disabled:!0},{type:"input",label:"项目名称",prop:"projectName",placeholder:"请输入项目名称"},{type:"select",label:"应用系统名称",prop:"appsysName",id:"appsysId",placeholder:"请选择应用系统名称",seleteOption:this.$store.getters.systemType,methods:function(e){t.$refs.editForm.setFormItem("appsysId",e.value),t.$refs.editForm.setFormItem("appsysName",e.name)}},{label:"责任人",prop:"assignName",idsStr:"assignEmpid",type:"user",isHide:!this.isWorkFlowEdit,required:!0,trigger:"change"},{label:"影响概述",prop:"affectContent",type:"textarea",span:24,rows:4},{label:"变更描述",prop:"appContent",type:"textarea",span:24,rows:4}]},procInstType:null,attachSetting:{title:"",select:!1,billType:this.procInstType,sourceId:"",btnArr:["add","delete","save"]},scoreSetting:{title:"",billType:this.procInstType,sourceId:"",data:[],btnArr:["save"]},scoreHideBtn:!1,coverList:[],dialogVisible:!1,activeName:"0",hideBtn:!1,showScore:!1,beforeSubmit:{methods:function(e){return t.submitBefore(e)}}}},computed:{workFlowParams:function(){var t=this.editFormData.procInstType;return 4===this.formData.status&&this.formData.workflowIsApprover?{procInstType:t||"",assignercodes:[this.editFormData.confirmMan]}:{procInstType:t||""}},isWorkFlowEdit:function(){return!(4!==this.formData.status||!this.formData.workflowIsApprover)}},mounted:function(){this.init()},methods:{init:function(){if("add"==this.pageType){var t={};this.defaultSet&&(t=Object(l["a"])({},this.formData)),this.editFormData=Object.assign({},t,{billDate:this.$utils.getNowDay()})}else this.getDetails(this.formData.id);"details"==this.pageType&&(this.isWorkFlowEdit||this.formConfig.itemArr.map((function(t){return t.disabled=!0})),this.attachSetting.sourceId=this.formData.id),"score"==this.pageType&&(this.scoreSetting.sourceId=this.formData.id,this.formConfig.itemArr.map((function(t){return t.disabled=!0})),this.showScore=!0)},getDetails:function(t){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function a(){var i,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,f(t);case 2:i=a.sent,o=i.data||{},e.procInstType=o.procInstType,e.attachSetting.sourceId=o.id,e.editFormData=Object.assign({},o,{confirmMan:o.empId,confirmManName:o.zystaffunName});case 7:case"end":return a.stop()}}),a)})))()},submitBefore:function(t){var e=this;return!this.isWorkFlowEdit||new Promise((function(t,a){e.$refs.editForm.getFormData().then((function(i){e.$set(i,"submitType",1),e.editFormData=Object.assign({},i),b(i).then((function(e){t()})).catch((function(t){a(t)}))})).catch((function(t){a("表单信息未填写完整")}))}))},workFlowSuccess:function(){this.$emit("update:pageType","list")},getFormData:function(){return this.$refs.editForm.getFormData()},getServiceType:function(){if("details"!=this.pageType){var t=this.$refs.editForm.getFormItem("sourceId");this.hadSeleteData=[{id:t}],this.showSelete=!0}},changeServiceType:function(t){console.log(t);var e=Object(r["a"])(t,1),a=e[0],i=a.id,o=a.orderNo,n=a.procInstType;this.$refs.editForm.setFormItem("serviceOrderNo",o),this.$refs.editForm.setFormItem("serviceId",i),this.$refs.editForm.setFormItem("serviceType",n)}}},D=y,w=a("2877"),v=Object(w["a"])(D,s,c,!1,null,"3b6b0266",null),S=v.exports,T=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"distributionDialog"},[a("editForm",{ref:"editForm",attrs:{formConfig:t.formConfig,formData:t.editFormData}})],1)},F=[],I=(a("a9e3"),{props:{distributionData:{type:Object,default:{}},maxNum:{type:Number,default:0}},name:"distributionDialog",data:function(){return{editFormData:{},formConfig:{itemArr:[{label:"申请日期",prop:"billDate",type:"date",disabled:!0,required:!0,span:24},{label:"申请人",prop:"staffunName",required:!0,disabled:!0,type:"text",span:24},{label:"责任人",prop:"assignName",idsStr:"assignEmpid",type:"user",trigger:"change",required:!0,span:24}]}}},watch:{distributionData:{handler:function(t,e){this.editFormData=Object.assign({},t)},deep:!0}},created:function(){this.init()},methods:{init:function(){this.editFormData=Object.assign({},this.distributionData)},getFormData:function(){var t=this;return new Promise((function(e,a){t.$refs.editForm.getFormData().then((function(t){t=Object.assign({},t),e(t)})).catch((function(t){a(t)}))}))}}}),O=I,j=Object(w["a"])(O,T,F,!1,null,null,null),$=j.exports,N=a("01a0"),C={name:"changeManagement",components:{addInfo:S,distributionDialog:$},data:function(){var t=this;return{label:"",otherInfo:"",showScore:!1,distributionDialog:!1,distributionData:{},currentItem:{},tableConfig:{showFixedHeight:!0,searchObj:{searchMethod:function(e,a){t.tableConfig.tableDataObj&&t.getTableData()},searchArr:[{type:"el-input",label:"变更单号",model:"orderNo",placeholder:"变更单号"},{type:"daterange",label:"申请日期",model:"billDate"},{type:"el-input",label:"申请人",model:"staffunName",placeholder:"申请人"},{type:"el-select",label:"审核状态",model:"status",placeholder:"审核状态",option:this.$store.getters["dirtData"]("flow_type")},{type:"el-input",label:"关键字",model:"fuzzyQuery",placeholder:"关键字（项目名称、系统名称）"}]},queryObj:{method:function(){t.getTableData()},queryData:{page:1,pageSize:15}},tableDataObj:{tableArr:[],total:null},operateArr:[{name:"新建",icon:"el-icon-plus",method:function(e){t.toAdd()}}],tableObj:{selectionShow:!1,indexShow:!0,tableMethods:{selection:function(e){t.selectionData=e}},showItems:[{name:"变更单号",prop:"orderNo",width:100},{name:"申请日期",prop:"billDate"},{name:"申请人",prop:"staffunName"},{name:"项目名称",prop:"projectName"},{name:"应用系统名称",prop:"appsysName",id:"appsysId"},{name:"变更描述",prop:"appContent"},{name:"责任人",prop:"assignName",id:"assignEmpid"},{name:"备注",prop:"remark"},{name:"审批人",prop:"auditorName",id:"auditor"},{name:"流程节点",prop:"stage"},{name:"流程状态",prop:"flowStatusName",id:"status"},{name:"操作",prop:"operate",width:150,scopeType:"button",fixed:"right",buttonArr:[{name:"详情",method:function(e){t.detailsInfo(e)},isShow:function(t,e){return!0},icon:"false"},{name:"审批",method:function(e){t.detailsInfo(e)},isShow:function(t,e){return t.workflowIsApprover},icon:"false"},{name:"编辑",method:function(e){t.editInfo(e)},isShow:function(t,e){return 2===t.status},icon:"false"},{name:"评分",method:function(e){t.score(e)},isShow:function(t,e){return 1===t.status},icon:"false"},{name:"分配",method:function(e){t.distributionData=e,t.distributionDialog=!0},isShow:function(t,e){return 1===t.status},icon:"false"},{name:"删除",method:function(e){t.deleteInfo(e)},isShow:function(t,e){return 2===t.status},icon:"false"}]}]},paginationObj:{pageSizes:[15,30,50,100]},paginationIsshow:!0,showklTable:!1},pageType:"list",formData:{}}},computed:{rightBtnArr:function(){var t=this,e=[{text:"保存",icon:"el-icon-check",hide:"details"==this.pageType,methods:function(){t.doSubmit(2)}},{text:"提交",icon:"el-icon-finished",hide:"details"==this.pageType,methods:function(){t.doSubmit(1)}}];return e}},watch:{"tableConfig.queryObj.queryData.staffunName":function(t){""==t&&(this.tableConfig.queryObj.queryData.empId=null)},pageType:function(t){"list"===t&&this.getTableData()}},mounted:function(){this.getTableData()},methods:(g={toAdd:function(){this.pageType="add",this.formData={}},getTableData:function(){var t=this,e=Object.assign({},this.tableConfig.queryObj.queryData);e.pageCount=e.pageSize;var a=e.billDate;if(a){var i=Object(r["a"])(a,2),o=i[0],n=i[1];e.beginDate=o,e.endDate=n}this.$delete(e,"billDate"),this.$delete(e,"pageSize"),this.$delete(e,"empId"),p(e).then((function(e){t.$set(t.tableConfig.tableDataObj,"tableArr",e.data.list||[]),t.$set(t.tableConfig.tableDataObj,"total",e.data.total||0)})).catch((function(e){t.$set(t.tableConfig.tableDataObj,"tableArr",[]),t.$set(t.tableConfig.tableDataObj,"total",0)}))},addDistribution:function(t){return new Promise((function(e,a){addPortion(t).then((function(t){e(t)})).catch((function(t){console.log(t),a(t)}))}))},detailsInfo:function(t){this.pageType="details",this.formData=Object.assign({},t)},editInfo:function(t){this.pageType="edit",this.formData=Object.assign({},t)},score:function(t){this.pageType="score",this.formData=Object.assign({},t)},distributionSubmit:function(){var t=this;this.$refs.distributionFrom.getFormData().then((function(e){var a=e.assignEmpid,i=e.procInstType,o=e.id,n={assignEmpid:a,procInstType:i,id:o};t.addDistribution(n).then((function(e){t.$message.success("操作成功！"),t.distributionDialog=!1,t.getTableData()}))})).catch((function(t){console.log(t)}))}},Object(n["a"])(g,"addDistribution",(function(t){return new Promise((function(e,a){Object(N["a"])(t).then((function(t){e(t)})).catch((function(t){console.log(t),a(t)}))}))})),Object(n["a"])(g,"deleteInfo",(function(t){var e=this;this.$confirm("是否确认删除","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){m(t.id).then((function(t){e.$message.success("操作成功"),e.getTableData()}))})).catch((function(t){}))})),Object(n["a"])(g,"doSubmit",(function(t){var e=this;this.$refs.editForm.getFormData().then((function(a){e.$set(a,"submitType",t),e.$delete(a,"depatName"),e.$delete(a,"depatCode"),e.$delete(a,"phone");var i=function(t){return t.id?b(t):h(t)};i(a).then((function(a){e.$message.success("操作成功！"),2==t?(e.pageType="edit",a.data&&(e.formData.id=a.data),e.$refs.editForm.getDetails(e.formData.id)):e.pageType="list"}))})).catch((function(t){console.log(t)}))})),Object(n["a"])(g,"goBackPage",(function(t){this.pageType="list"})),Object(n["a"])(g,"toExport",(function(){var t=Object({NODE_ENV:"production",VUE_APP_BASEURL:"",BASE_URL:""}).BASEURL,e="",a=Object.assign({},this.tableConfig.queryObj.queryData);for(var i in a.daterange&&(a.comeinStart=a.daterange[0]||"",a.comeinEnd=a.daterange[1]||"",delete a.daterange),a)e+="".concat(i,"=").concat(a[i],"&");e=e.substring(0,e.length-1);var o="".concat(t,"/trainRecord/exportAdmUnPass.htm?").concat(e);window.open(o)})),g)},A=C,_=Object(w["a"])(A,i,o,!1,null,null,null);e["default"]=_.exports}}]);
//# sourceMappingURL=chunk-2d217ae8.5760770d.js.map