(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-342eead4"],{"033d":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"usersApply h100"},[a("div",{staticClass:"page-main-box"},[a("KlTable",e._b({directives:[{name:"show",rawName:"v-show",value:"list"==e.pageType,expression:"pageType == 'list'"}],ref:"klTable"},"KlTable",e.tableConfig,!1)),"list"!==e.pageType?a("editPage",{attrs:{rightBtnArr:e.rightBtnArr},on:{goBackPage:e.goBackPage}},[a("addInfo",{ref:"editForm",attrs:{pageType:e.pageType,formData:e.formData},on:{"update:pageType":function(t){e.pageType=t},"update:page-type":function(t){e.pageType=t}}})],1):e._e()],1)])},n=[],s=(a("99af"),a("4160"),a("d3b7"),a("159b"),a("3835")),i=a("f509"),r=a("19d6"),l={name:"softwareApply",components:{addInfo:i["a"]},data:function(){var e=this;return{label:"",otherInfo:"",showScore:!1,currentItem:{},tableConfig:{showFixedHeight:!0,searchObj:{searchMethod:function(t,a){e.tableConfig.tableDataObj&&e.getTableData()},searchArr:[{type:"daterange",label:"申请日期",model:"billDate"},{type:"el-input",label:"服务单号",model:"orderNo",placeholder:"服务单号"},{type:"el-input",label:"申请人",model:"staffunName",placeholder:"申请人"},{type:"el-select",label:"操作类型",model:"apptype",option:this.$store.getters["dirtData"]("soft_type")}]},queryObj:{method:function(){e.getTableData()},queryData:{page:1,pageSize:15}},tableDataObj:{tableArr:[],total:null},operateArr:[{name:"新建",icon:"el-icon-plus",method:function(t){e.toAdd()}}],tableObj:{selectionShow:!1,indexShow:!0,tableMethods:{selection:function(t){e.selectionData=t}},showItems:[{name:"服务单号",prop:"orderNo",width:100},{name:"申请日期",prop:"billDate"},{name:"申请人",prop:"staffunName"},{name:"申请部门",prop:"depatName"},{name:"联系号码",prop:"phone"},{name:"软件操作类型",prop:"apptype",scopeType:"formate",method:function(t){var a=t.apptype;return e.$store.getters["fineDirtDataName"]("soft_type",a)||a}},{name:"申请描述",prop:"appContent"},{name:"备注",prop:"remark"},{name:"审批人",prop:"auditorName"},{name:"流程节点",prop:"stage"},{name:"流程状态",prop:"flowStatusName",id:"status"},{name:"操作",prop:"operate",width:150,scopeType:"button",fixed:"right",buttonArr:[{name:"详情",method:function(t){e.detailsInfo(t)},isShow:function(e,t){return!0},icon:"false"},{name:"审批",method:function(t){e.detailsInfo(t)},isShow:function(e,t){return e.workflowIsApprover},icon:"false"},{name:"编辑",method:function(t){e.editInfo(t)},isShow:function(e,t){return 2===e.status},icon:"false"},{name:"评分",method:function(t){e.score(t)},isShow:function(e,t){return 1===e.status},icon:"false"},{name:"删除",method:function(t){e.deleteInfo(t)},isShow:function(e,t){return 2===e.status},icon:"false"}]}]},paginationObj:{pageSizes:[15,30,50,100]},paginationIsshow:!0,showklTable:!1},pageType:"list",formData:{}}},computed:{rightBtnArr:function(){var e=this,t=[{text:"保存",icon:"el-icon-check",hide:"details"==this.pageType,methods:function(){e.doSubmit(2)}},{text:"提交",icon:"el-icon-finished",hide:"details"==this.pageType,methods:function(){e.doSubmit(1)}}];return t}},watch:{"tableConfig.queryObj.queryData.staffunName":function(e){""==e&&(this.tableConfig.queryObj.queryData.empId=null)},pageType:function(e){"list"===e&&this.getTableData()}},mounted:function(){this.getTableData()},methods:{toAdd:function(){this.pageType="add",this.formData={}},getTableData:function(){var e=this,t=Object.assign({},this.tableConfig.queryObj.queryData);t.pageCount=t.pageSize;var a=t.billDate;if(a){var o=Object(s["a"])(a,2),n=o[0],i=o[1];t.beginDate=n,t.endDate=i}this.$delete(t,"billDate"),this.$delete(t,"pageSize"),this.$delete(t,"empId"),Object(r["e"])(t).then((function(t){e.$set(e.tableConfig.tableDataObj,"tableArr",t.data.list||[]),e.$set(e.tableConfig.tableDataObj,"total",t.data.total||0)})).catch((function(t){e.$set(e.tableConfig.tableDataObj,"tableArr",[]),e.$set(e.tableConfig.tableDataObj,"total",0)}))},addDistribution:function(e){return new Promise((function(t,a){addPortion(e).then((function(e){t(e)})).catch((function(e){console.log(e),a(e)}))}))},detailsInfo:function(e){this.pageType="details",this.formData=Object.assign({},e)},editInfo:function(e){this.pageType="edit",this.formData=Object.assign({},e)},score:function(e){this.pageType="score",this.formData=Object.assign({},e)},deleteInfo:function(e){var t=this;this.$confirm("是否确认删除","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(r["b"])(e.id).then((function(e){t.$message.success("操作成功"),t.getTableData()}))})).catch((function(e){}))},doSubmit:function(e){var t=this,a=null;this.$refs.editForm.getFormData().then((function(o){a=o,t.$refs.editForm.getTableData().then((function(o){if(o.length){var n=!0;if(o.forEach((function(e){var t=parseInt(e.instock);e.qty>t&&(n=!1)})),n){a.det=o;var s=function(e){return e.id?Object(r["f"])(e):Object(r["a"])(e)};t.$set(a,"submitType",e),t.$delete(a,"confirmManName"),t.$delete(a,"appsysName"),t.$delete(a,"assetTypeName"),"2"==e||"1"==e&&a.confirmMan?s(a).then((function(a){t.$message.success("操作成功！"),2==e?(t.pageType="edit",a.data&&(t.formData.id=a.data),t.$refs.editForm.getDetails(t.formData.id)):t.pageType="list"})):t.$message.warning("请选择审批人！")}else t.$message.warning("申请数量不能大于库存数量！")}else t.$message.warning("请选择需申请的软件！")}))})).catch((function(e){console.log(e)}))},addMethons:function(e){return e.id?new Promise((function(t,a){updateRegist(e).then((function(e){t(e)})).catch((function(e){console.log(e),a(e)}))})):new Promise((function(t,a){Object(r["a"])(e).then((function(e){t(e)})).catch((function(e){console.log(e),a(e)}))}))},goBackPage:function(e){this.pageType="list"},toExport:function(){var e=Object({NODE_ENV:"production",VUE_APP_BASEURL:"",BASE_URL:""}).BASEURL,t="",a=Object.assign({},this.tableConfig.queryObj.queryData);for(var o in a.daterange&&(a.comeinStart=a.daterange[0]||"",a.comeinEnd=a.daterange[1]||"",delete a.daterange),a)t+="".concat(o,"=").concat(a[o],"&");t=t.substring(0,t.length-1);var n="".concat(e,"/trainRecord/exportAdmUnPass.htm?").concat(t);window.open(n)}}},c=l,d=a("2877"),p=Object(d["a"])(c,o,n,!1,null,null,null);t["default"]=p.exports},"19d6":function(e,t,a){"use strict";a.d(t,"e",(function(){return n})),a.d(t,"c",(function(){return s})),a.d(t,"d",(function(){return i})),a.d(t,"b",(function(){return r})),a.d(t,"a",(function(){return l})),a.d(t,"f",(function(){return c}));var o=a("fd03");function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(o["a"])({url:"/workorder/OfficeappAction/queryList.htm",method:"post",data:e})}function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(o["a"])({url:"/workorder/OfficeappAction/queryRegist.htm",method:"post",data:e})}function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Object(o["a"])({url:"/workorder/OfficeappAction/detail.htm",method:"post",params:{id:e}})}function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Object(o["a"])({url:"/workorder/OfficeappAction/delete.htm",method:"post",params:{id:e}})}function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(o["a"])({url:"/workorder/OfficeappAction/addOfficeapp.htm",method:"post",data:e})}function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(o["a"])({url:"/workorder/OfficeappAction/updateOfficeapp.htm",method:"post",data:e})}},f509:function(e,t,a){"use strict";var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"record__content"},[a("div",{staticClass:"record__baseinfo"},[a("dividerTitle",{attrs:{title:"基本信息"}}),a("editForm",{ref:"editForm",attrs:{formConfig:e.formConfig,formData:e.editFormData},scopedSlots:e._u([{key:"assetsNumber",fn:function(t){var o=t.editFormInfo;return[a("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请选择资产信息",readonly:"",disabled:"details"==e.pageType&&!e.isWorkFlowEdit,size:"mini"},model:{value:o.assetsNumber,callback:function(t){e.$set(o,"assetsNumber",t)},expression:"editFormInfo.assetsNumber"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:function(t){return t.stopPropagation(),e.goSeleteAsset(t)}},slot:"append"})],1)]}}])})],1),e.editFormData.status&&1==e.editFormData.status?a("div",{staticClass:"process_score"},[a("dividerTitle",{attrs:{title:"评分"}}),e.showScore?a("processScore",{attrs:{scoreSetting:e.scoreSetting,hideBtn:e.scoreHideBtn,showScore:e.showScore},on:{"update:showScore":function(t){e.showScore=t},"update:show-score":function(t){e.showScore=t}}}):e._e()],1):e._e(),a("div",{staticClass:"software_details"},[a("dividerTitle",{attrs:{title:"软件申请明细"}}),a("editTable",{ref:"checkSoftware",attrs:{tableSetting:e.detailsSetting,hideBtn:e.hideBtn},on:{handleClickAdd:e.addSoftware}})],1),"details"==e.pageType&&e.editFormData.status&&2!==e.editFormData.status?a("div",{staticClass:"record__workflow"},[a("dividerTitle",{attrs:{title:"工作流"}}),a("workFlow",{attrs:{currentFlowData:e.editFormData,beforeSubmit:e.beforeSubmit,otherParams:e.workFlowParams},on:{submitSuccess:e.workFlowSuccess}})],1):e._e(),e.showSelete?a("softwareSelete",{attrs:{hadSeleteData:e.hadSeleteData,showSelete:e.showSelete},on:{changeSelete:e.changeSeleteSorft,"update:showSelete":function(t){e.showSelete=t},"update:show-selete":function(t){e.showSelete=t}}}):e._e(),e.showAssetSelete?a("assetSelete",{attrs:{hadSeleteData:e.assetSeleteData,showSelete:e.showAssetSelete,userID:e.employeeId},on:{changeSelete:e.changeSeleteAsset,"update:showSelete":function(t){e.showAssetSelete=t},"update:show-selete":function(t){e.showAssetSelete=t}}}):e._e()],1)},n=[],s=(a("4160"),a("d81d"),a("d3b7"),a("159b"),a("3835")),i=(a("96cf"),a("1da1")),r=a("5530"),l=a("19d6"),c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"software-selete"},[a("dialogPublic",{attrs:{title:"可选软件",show:e.showDialong,fullscreen:"",appendTobody:""},on:{"update:show":function(t){e.showDialong=t},doSubmit:e.doSave,doClose:e.doClose}},[a("seleteTable",{ref:"seleteTable",attrs:{tableSetting:e.tableSetting,hadData:e.hadSeleteData}})],1)],1)},d=[],p=a("7b5c"),u={props:{hadSeleteData:{type:Array,default:new Array},showSelete:{type:Boolean,default:!0}},components:{seleteTable:p["a"]},data:function(){return{tableSetting:{maxHeight:"600px",column:[{label:"资产分类",prop:"assetTypeName"},{label:"资产型号",prop:"goodsModel"},{label:"登记单号",prop:"billNo"},{label:"库存数量",prop:"instock"}],data:[]},showDialong:!0}},created:function(){this.getAssets()},methods:{getAssets:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(l["c"])();case 2:a=t.sent,o=a.data,e.$refs.seleteTable.setTableData(o||[]);case 5:case"end":return t.stop()}}),t)})))()},doClose:function(){this.$emit("update:showSelete",!1)},doSave:function(){var e=this.$refs.seleteTable.getSeleteData();this.$emit("changeSelete",e),this.doClose()}}},f=u,h=a("2877"),m=Object(h["a"])(f,c,d,!1,null,null,null),b=m.exports,g={props:{formData:{type:Object,default:new Object},pageType:{type:String,default:""},defaultSet:{type:Boolean,default:!1}},components:{softwareSelete:b},data:function(){var e=this;return{hadSeleteData:[],assetSeleteData:[],employeeId:null,showSelete:!1,showAssetSelete:!1,editFormData:{suitableWorkArr:[]},trainingType:{},hideBtn:!1,maxNum:0,detailsSetting:{title:"",select:!0,addMethons:!0,maxHeight:400,btnArr:["add","delete"],column:[{label:"资产分类",prop:"assetTypeName",readonly:!0,disabled:!0,type:"text"},{label:"资产型号",prop:"goodsModel",type:"text",readonly:!0,disabled:!0},{label:"登记单号",prop:"billNo",type:"text",readonly:!0,disabled:!0},{label:"申请时库存",prop:"instock",type:"number",min:0,disabled:!0},{label:"数量",prop:"qty",type:"number",min:0,precision:0,step:1,disabled:!1,required:!0}]},formConfig:{itemArr:[{label:"申请日期",prop:"billDate",type:"date",span:8},{label:"申请人",prop:"staffunName",idsStr:"employeeId",type:"user",trigger:"change",methods:function(t){var a=t[0],o=a.orgNodeName,n=a.orgNodeCode,s=a.mobile,i=a.id;e.employeeId=i,e.$refs.editForm.setFormItem("depatName",o),e.$refs.editForm.setFormItem("depatCode",n),e.$refs.editForm.setFormItem("phone",s)}},{label:"申请部门",prop:"depatName",id:"depatCode",disabled:!0,placeholder:"选择申请人后自动带出",type:"text"},{label:"联系号码",prop:"phone",type:"text",placeholder:"选择申请人后自动带出",rules:{validator:function(e,t,a){var o=/^[0-9]*$/;if(t){if(!o.test(t))return a(new Error("请填写正确的手机号码！"));a()}else;},trigger:"change"}},{label:"资产编号",prop:"assetsNumber",type:"text"},{type:"text",label:"资产类型",prop:"assetTypeName",placeholder:"选择资产后自动带出",disabled:!0},{label:"资产型号",prop:"gModel",type:"text",placeholder:"选择资产后自动带出",disabled:!0},{type:"select",label:"申请类型",prop:"apptype",seleteOption:this.$store.getters["dirtData"]("soft_type"),formatter:function(t){return e.$store.getters["fineDirtDataName"]("soft_type",t)}},{label:"审批人",prop:"confirmManName",idsStr:"confirmMan",type:"user",isHide:"details"==this.pageType&&!this.isWorkFlowEdit,trigger:"change"},{label:"申请描述",prop:"appContent",type:"textarea",span:24,rows:4},{label:"备注",prop:"remark",type:"textarea",span:24,rows:4}]},procInstType:null,scoreSetting:{title:"",billType:"asset_regist",sourceId:"",data:[],btnArr:["save"]},scoreHideBtn:!1,coverList:[],dialogVisible:!1,activeName:"0",showScore:!1,beforeSubmit:{methods:function(t){return e.submitBefore(t)}}}},computed:{workFlowParams:function(){var e=this.editFormData.procInstType;return 4===this.formData.status&&this.formData.workflowIsApprover?{procInstType:e||"",assignercodes:[this.editFormData.confirmMan]}:{procInstType:e||""}},isWorkFlowEdit:function(){return!(4!==this.formData.status||!this.formData.workflowIsApprover)}},mounted:function(){this.init()},methods:{init:function(){if("add"==this.pageType){var e={};this.defaultSet&&(e=Object(r["a"])({},this.formData)),this.editFormData=Object.assign({},e,{billDate:this.$utils.getNowDay()})}else this.getDetails(this.formData.id);"details"==this.pageType&&(this.isWorkFlowEdit||(this.formConfig.itemArr.map((function(e){return e.disabled=!0})),this.hideBtn=!0),this.hideBtn=!0),"details"==this.pageType&&"4"==this.formData.status&&(this.hideBtn=!1),"1"==this.formData.status&&(this.hideBtn=!0),"score"==this.pageType&&(this.scoreSetting.sourceId=this.formData.id,this.formConfig.itemArr.map((function(e){return e.disabled=!0})),this.showScore=!0)},getDetails:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var o,n,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,Object(l["d"])(e);case 2:o=a.sent,n=o.data||{},t.editFormData=Object.assign({},n,{confirmMan:n.empId,confirmManName:n.zystaffunName}),n&&(t.employeeId=t.editFormData.employeeId),s=o.data.det,"edit"===t.pageType&&s.map((function(e){e.editable=!0})),t.$refs.checkSoftware.setTableData(s);case 9:case"end":return a.stop()}}),a)})))()},submitBefore:function(e){var t=this;return!this.isWorkFlowEdit||new Promise((function(e,a){var o=null;t.$refs.editForm.getFormData().then((function(n){o=n,t.$set(o,"submitType",1),t.editFormData=Object.assign({},n),t.$refs.checkSoftware.getTableData().then((function(n){if(n.length){var s=!0;n.forEach((function(e){var t=parseInt(e.instock);e.qty>t&&(s=!1)})),s?(o.det=n,t.$delete(o,"confirmManName"),t.$delete(o,"appsysName"),t.$delete(o,"assetTypeName"),Object(l["f"])(o).then((function(t){e()})).catch((function(e){a(e)}))):t.$message.warning("申请数量不能大于库存数量！")}else t.$message.warning("请选择需申请的软件！")}))})).catch((function(e){console.log(e),a("表单信息未填写完整")}))}))},workFlowSuccess:function(){this.$emit("update:pageType","list")},getFormData:function(){return this.$refs.editForm.getFormData()},getTableData:function(){return this.$refs.checkSoftware.getTableData()},addSoftware:function(e,t){this.showSelete=!0},changeSeleteSorft:function(e){var t=this,a=Object(s["a"])(e,1);a[0];e.map((function(e){e.qty=1,e.sourceId=e.id,e.editable=!0,t.$delete(e,"id")})),this.$refs.checkSoftware.setTableData(e||[])},goSeleteAsset:function(){if(this.employeeId){if("details"==this.pageType)return;var e=this.$refs.editForm.getFormItem("sourceId");this.assetSeleteData=[{id:e}],this.showAssetSelete=!0}else this.$message.warning("请先选择申请人")},changeSeleteAsset:function(e){var t=Object(s["a"])(e,1),a=t[0],o=a.assetsNumber,n=a.assetTypeName,i=(a.assetTypeId,a.goodsModel),r=a.id;this.$refs.editForm.setFormItem("assetsNumber",o),this.$refs.editForm.setFormItem("assetTypeName",n),this.$refs.editForm.setFormItem("assetsId",r),this.$refs.editForm.setFormItem("gModel",i)}}},w=g,y=Object(h["a"])(w,o,n,!1,null,"953dacf2",null);t["a"]=y.exports}}]);
//# sourceMappingURL=chunk-342eead4.d3dfaf1b.js.map